# LLMæ™ºèƒ½å‡ºé¢˜è€ƒè¯•ç³»ç»Ÿ - åç«¯

åŸºäºFastAPIçš„é«˜æ€§èƒ½å¼‚æ­¥åç«¯æœåŠ¡

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: FastAPI 0.115+
- **æ•°æ®åº“**: SQLite (å¼‚æ­¥) / PostgreSQL (å¯é€‰)
- **ORM**: SQLAlchemy 2.0 (å¼‚æ­¥æ¨¡å¼)
- **è®¤è¯**: JWT + bcrypt
- **LLM**: å¤šæ¨¡å‹æ”¯æŒ (DeepSeek/Qwen/GLM)
- **Python**: 3.10+

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶,é…ç½®å¿…è¦çš„å‚æ•°
# é‡è¦: ä¿®æ”¹SECRET_KEYå’ŒLLM APIå¯†é’¥
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# æ–¹å¼1: ä½¿ç”¨uvicorn
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æ–¹å¼2: ç›´æ¥è¿è¡Œmain.py
python -m app.main

# æ–¹å¼3: ä½¿ç”¨fastapi cli (éœ€è¦å®‰è£…fastapi-cli)
fastapi dev app/main.py
```

### 5. è®¿é—®APIæ–‡æ¡£

- Swagger UI: http://localhost:8000/api/docs
- ReDoc: http://localhost:8000/api/redoc
- å¥åº·æ£€æŸ¥: http://localhost:8000/health

## é¡¹ç›®ç»“æ„

```
Back-end/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py           # åº”ç”¨åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ main.py               # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç† (Pydantic Settings)
â”‚   â”œâ”€â”€ api/                  # APIè·¯ç”±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py       # è·¯ç”±å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ deps.py           # âœ… ä¾èµ–æ³¨å…¥ (è®¤è¯ã€æƒé™)
â”‚   â”‚   â”œâ”€â”€ auth.py           # âœ… è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ llm.py            # âœ… LLMé€šç”¨è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ questions.py      # âœ… é¢˜ç›®ç”Ÿæˆè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ courses.py        # âœ… è¯¾ç¨‹ç®¡ç†è·¯ç”±
â”‚   â”‚   â””â”€â”€ exams.py          # âœ… è€ƒè¯•ç®¡ç†è·¯ç”± ğŸ†•
â”‚   â”œâ”€â”€ models/               # SQLAlchemyæ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py       # æ¨¡å‹å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ user.py           # âœ… ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ course.py         # âœ… è¯¾ç¨‹/çŸ¥è¯†ç‚¹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ question.py       # âœ… é¢˜ç›®/è¯•å·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ exam.py           # âœ… è€ƒè¯•/ç­”é¢˜æ¨¡å‹
â”‚   â”‚   â””â”€â”€ llm_log.py        # âœ… LLMæ—¥å¿—æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/              # Pydanticè¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py       # Schemaå¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ user.py           # âœ… ç”¨æˆ·Schema
â”‚   â”‚   â”œâ”€â”€ question.py       # âœ… é¢˜ç›®Schema
â”‚   â”‚   â”œâ”€â”€ course.py         # âœ… è¯¾ç¨‹/çŸ¥è¯†ç‚¹Schema
â”‚   â”‚   â””â”€â”€ exam.py           # âœ… è€ƒè¯•/ç­”é¢˜Schema ğŸ†•
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py       # æœåŠ¡å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ auth.py           # âœ… è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ llm_service.py    # âœ… LLMç»Ÿä¸€æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ generator_service.py   # âœ… é¢˜ç›®ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ validator_service.py   # âœ… è§„åˆ™æ ¡éªŒå™¨
â”‚   â”‚   â”œâ”€â”€ reviewer_service.py    # âœ… AIè‡ªå®¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ generation_pipeline.py # âœ… ç”Ÿæˆæµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ course_service.py # âœ… è¯¾ç¨‹ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ exam_service.py   # âœ… è€ƒè¯•ç®¡ç†æœåŠ¡ ğŸ†•
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒå·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py       # å·¥å…·å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ security.py       # âœ… JWT/å¯†ç åŠ å¯†
â”‚   â”‚   â””â”€â”€ llm/              # âœ… LLM ProvideræŠ½è±¡
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py       # âœ… æŠ½è±¡åŸºç±»
â”‚   â”‚       â”œâ”€â”€ deepseek.py   # âœ… DeepSeek Provider
â”‚   â”‚       â”œâ”€â”€ qwen.py       # âœ… Qwen Provider
â”‚   â”‚       â””â”€â”€ glm.py        # âœ… GLM Provider
â”‚   â””â”€â”€ db/                   # æ•°æ®åº“ç›¸å…³
â”‚       â”œâ”€â”€ __init__.py       # æ•°æ®åº“å¯¼å‡º
â”‚       â”œâ”€â”€ base.py           # âœ… Baseç±»/Mixin
â”‚       â”œâ”€â”€ session.py        # âœ… æ•°æ®åº“ä¼šè¯
â”‚       â””â”€â”€ init_db.py        # âœ… æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ docs/                     # æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ DATABASE_DESIGN.md    # âœ… æ•°æ®åº“è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ tests/                    # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ logs/                     # æ—¥å¿—æ–‡ä»¶ (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .env                      # ç¯å¢ƒå˜é‡ (éœ€åˆ›å»º)
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–
â”œâ”€â”€ test_auth.py              # è®¤è¯æµ‹è¯•è„šæœ¬
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

> âœ… = å·²å®ç° | ğŸš§ = å¾…å®ç°

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç”¨æˆ·è®¤è¯ä¸æˆæƒ âœ…

- JWT Tokenè®¤è¯ (7å¤©æœ‰æ•ˆæœŸ)
- è§’è‰²æƒé™æ§åˆ¶ (å­¦ç”Ÿ/æ•™å¸ˆ/ç®¡ç†å‘˜)
- bcryptå¯†ç åŠ å¯†å­˜å‚¨
- OAuth2å…¼å®¹çš„ç™»å½•æ¥å£

### 2. LLMè°ƒç”¨å°è£…å±‚ âœ…

å¤šæ¨¡å‹ProvideræŠ½è±¡æ¶æ„ï¼Œæ”¯æŒçµæ´»åˆ‡æ¢ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LLMService                             â”‚
â”‚              (ç»Ÿä¸€æ¥å£ + æ—¥å¿—è®°å½• + é”™è¯¯å¤„ç†)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  DeepSeek   â”‚  â”‚    Qwen     â”‚  â”‚     GLM     â”‚       â”‚
â”‚   â”‚  Provider   â”‚  â”‚  Provider   â”‚  â”‚  Provider   â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                â”‚                â”‚              â”‚
â”‚          â–¼                â–¼                â–¼              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚           BaseLLMProvider (æŠ½è±¡åŸºç±»)             â”‚     â”‚
â”‚   â”‚  - chat(): æ™®é€šå¯¹è¯                              â”‚     â”‚
â”‚   â”‚  - chat_stream(): æµå¼å¯¹è¯                       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹æ€§**:
- ç»Ÿä¸€çš„OpenAIå…¼å®¹APIæ ¼å¼
- è‡ªåŠ¨æ—¥å¿—è®°å½• (tokenæ•°ã€è€—æ—¶ã€åœºæ™¯)
- æ”¯æŒæµå¼è¾“å‡º (SSE)
- å¯é…ç½®çš„æ¨¡å‹å‚æ•° (temperature, max_tokensç­‰)

**é…ç½®ç¤ºä¾‹** (`.env`):
```bash
LLM_PROVIDER=deepseek
DEEPSEEK_API_KEY=your-api-key
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat
```

### 3. AIå‡ºé¢˜è´¨é‡æ§åˆ¶æµæ°´çº¿ âœ…

**ä¸‰é˜¶æ®µæµæ°´çº¿æ¶æ„** - æœ¬é¡¹ç›®çš„æ ¸å¿ƒåˆ›æ–°ç‚¹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GenerationPipeline                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Stage 1              Stage 2              Stage 3                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Generator â”‚  â”€â”€â”€â–¶  â”‚Validator â”‚  â”€â”€â”€â–¶  â”‚ Reviewer â”‚             â”‚
â”‚  â”‚ (LLM)    â”‚        â”‚ (è§„åˆ™)   â”‚        â”‚  (LLM)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                           â”‚                    â”‚                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”             â”‚
â”‚                      â”‚ æ ¼å¼é”™è¯¯ â”‚          â”‚ æœ‰é—®é¢˜  â”‚             â”‚
â”‚                      â”‚ REJECTED â”‚          â”‚         â”‚             â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”             â”‚
â”‚                                           â”‚å°è¯•ä¿®å¤ â”‚             â”‚
â”‚                                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
â”‚                                                â”‚                   â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                       â–¼                 â–¼         â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                  â”‚APPROVED â”‚      â”‚NEEDS_REVIEWâ”‚   â”‚
â”‚                                  â”‚ (é€šè¿‡)  â”‚      â”‚(äººå·¥å®¡æ ¸) â”‚   â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Stage 1: Generator (ç”Ÿæˆå™¨)
- ä½¿ç”¨LLMæ ¹æ®è¦æ±‚ç”Ÿæˆé¢˜ç›®
- æ”¯æŒå¤šç§é¢˜å‹ï¼šå•é€‰ã€å¤šé€‰ã€å¡«ç©ºã€ç®€ç­”
- å¯é…ç½®éš¾åº¦ã€çŸ¥è¯†ç‚¹ã€è¯­è¨€ç­‰å‚æ•°

#### Stage 2: Validator (è§„åˆ™æ ¡éªŒå™¨)
ä»£ç å®ç°çš„è§„åˆ™æ ¡éªŒï¼š
- âœ… JSONæ ¼å¼æ ¡éªŒ
- âœ… å•é€‰é¢˜ï¼šç­”æ¡ˆåœ¨é€‰é¡¹å†…ä¸”å”¯ä¸€
- âœ… å¤šé€‰é¢˜ï¼šç­”æ¡ˆé›†åˆéç©ºä¸”éƒ½åœ¨é€‰é¡¹å†…
- âœ… å¡«ç©ºé¢˜ï¼šç©ºæ•°é‡åŒ¹é…ç­”æ¡ˆæ•°é‡
- âœ… ç®€ç­”é¢˜ï¼šæä¾›è¯„åˆ†è¦ç‚¹
- âœ… å»é‡æ£€æµ‹ï¼šé¢˜å¹²å“ˆå¸Œæ¯”å¯¹

#### Stage 3: Reviewer (AIè‡ªå®¡)
ä½¿ç”¨LLMå®¡æ ¸é¢˜ç›®è´¨é‡ï¼š
- äº‹å®æ­£ç¡®æ€§æ£€æŸ¥
- ç­”æ¡ˆå”¯ä¸€æ€§/æ­§ä¹‰æ£€æµ‹
- è¡¨è¿°æ¸…æ™°æ€§å®¡æ ¸
- éš¾åº¦åŒ¹é…åº¦è¯„ä¼°
- è‡ªåŠ¨ä¿®å¤ä¸€æ¬¡æœºä¼š

**è¾“å‡ºåˆ†ç±»**:
| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `approved` | é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼Œå¯ç›´æ¥ä½¿ç”¨ |
| `needs_review` | éœ€è¦äººå·¥å®¡æ ¸ç¡®è®¤ |
| `rejected` | æ ¼å¼é”™è¯¯ï¼Œæ— æ³•ä½¿ç”¨ |

### 4. è¯¾ç¨‹ä¸çŸ¥è¯†ç‚¹ç®¡ç† âœ…
- è¯¾ç¨‹çš„å¢åˆ æ”¹æŸ¥
- çŸ¥è¯†ç‚¹æ— é™å±‚çº§æ ‘å½¢ç»“æ„ç®¡ç†
- çº§è”åˆ é™¤ä¿æŠ¤ (åˆ é™¤è¯¾ç¨‹è‡ªåŠ¨æ¸…ç†çŸ¥è¯†ç‚¹)

### 5. é¢˜ç›®ç®¡ç† ğŸš§
- å¤šé¢˜å‹æ”¯æŒ (å•é€‰/å¤šé€‰/å¡«ç©º/ç®€ç­”)
- çŸ¥è¯†ç‚¹å…³è”
- éš¾åº¦åˆ†çº§ (1-5çº§)

### 5. è€ƒè¯•ç³»ç»Ÿ âœ…
- è€ƒè¯•åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- è€ƒè¯•å‘å¸ƒä¸å…³é—­
- å­¦ç”Ÿå¼€å§‹ã€æäº¤è€ƒè¯•
- å®¢è§‚é¢˜è‡ªåŠ¨è¯„åˆ†

### 6. å­¦ä¹ åˆ†æ ğŸš§
- é”™é¢˜æœ¬
- è–„å¼±ç‚¹ç»Ÿè®¡
- å­¦ä¹ å»ºè®®

---

## API ç«¯ç‚¹

> å®Œæ•´çš„æ•°æ®åº“è®¾è®¡æ–‡æ¡£è¯·å‚é˜…: [docs/DATABASE_DESIGN.md](../docs/DATABASE_DESIGN.md)

### è®¤è¯æ¨¡å— (`/api/auth`) âœ…

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| POST | `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ | å¦ |
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• (JSON) | å¦ |
| POST | `/api/auth/login/form` | ç”¨æˆ·ç™»å½• (OAuth2è¡¨å•) | å¦ |
| GET | `/api/auth/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | æ˜¯ |
| PUT | `/api/auth/me` | æ›´æ–°ç”¨æˆ·èµ„æ–™ | æ˜¯ |

<details>
<summary>ğŸ“ è®¤è¯APIç¤ºä¾‹</summary>

**æ³¨å†Œç”¨æˆ·**
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "teacher@example.com",
    "name": "å¼ è€å¸ˆ",
    "password": "password123",
    "role": "teacher"
  }'
```

**ç™»å½•è·å–Token**
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "teacher@example.com",
    "password": "password123"
  }'
```

**å“åº”ç¤ºä¾‹**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "email": "teacher@example.com",
    "name": "å¼ è€å¸ˆ",
    "role": "teacher",
    "is_active": true
  }
}
```

</details>

### LLMé€šç”¨æ¨¡å— (`/api/llm`) âœ…

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| POST | `/api/llm/chat` | å‘é€å¯¹è¯è¯·æ±‚ | æ˜¯ |
| POST | `/api/llm/chat/stream` | æµå¼å¯¹è¯ (SSE) | æ˜¯ |
| POST | `/api/llm/simple` | ç®€å•æ–‡æœ¬è¯·æ±‚ | æ˜¯ |
| POST | `/api/llm/simple/stream` | ç®€å•æ–‡æœ¬æµå¼ | æ˜¯ |
| GET | `/api/llm/providers` | è·å–å¯ç”¨Provideråˆ—è¡¨ | æ˜¯ |

<details>
<summary>ğŸ“ LLM APIç¤ºä¾‹</summary>

**ç®€å•å¯¹è¯**
```bash
curl -X POST http://localhost:8000/api/llm/simple \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "ä»€ä¹ˆæ˜¯Pythonçš„è£…é¥°å™¨ï¼Ÿ",
    "system_prompt": "ä½ æ˜¯ä¸€ä¸ªç¼–ç¨‹ä¸“å®¶"
  }'
```

**æµå¼å¯¹è¯**
```bash
curl -X POST http://localhost:8000/api/llm/chat/stream \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"role": "user", "content": "è¯·è§£é‡Šä»€ä¹ˆæ˜¯é—­åŒ…"}
    ]
  }'
```

</details>

### é¢˜ç›®ç”Ÿæˆæ¨¡å— (`/api/questions`) âœ…

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | è®¤è¯ | è§’è‰² |
|------|------|------|------|------|
| POST | `/api/questions/generate` | å®Œæ•´æµæ°´çº¿ç”Ÿæˆ | æ˜¯ | æ•™å¸ˆ |
| POST | `/api/questions/generate/quick` | å¿«é€Ÿç”Ÿæˆ (è·³è¿‡AIå®¡æ ¸) | æ˜¯ | æ•™å¸ˆ |
| POST | `/api/questions/generate/stream` | æµå¼ç”Ÿæˆ (SSE) | æ˜¯ | æ•™å¸ˆ |
| GET | `/api/questions/types` | è·å–æ”¯æŒçš„é¢˜å‹ | å¦ | - |
| GET | `/api/questions/difficulties` | è·å–éš¾åº¦ç­‰çº§ | å¦ | - |

<details>
<summary>ğŸ“ é¢˜ç›®ç”ŸæˆAPIç¤ºä¾‹</summary>

**ç”Ÿæˆé¢˜ç›® (å®Œæ•´æµæ°´çº¿)**
```bash
curl -X POST http://localhost:8000/api/questions/generate \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "course_name": "Pythonç¼–ç¨‹",
    "knowledge_point": "åˆ—è¡¨æ“ä½œ",
    "question_type": "single",
    "difficulty": 3,
    "count": 3,
    "language": "zh"
  }'
```

**å“åº”ç¤ºä¾‹**
```json
{
  "summary": {
    "total": 3,
    "approved": 2,
    "needs_review": 1,
    "rejected": 0,
    "success_rate": 66.7
  },
  "approved_questions": [
    {
      "question": {
        "type": "single",
        "stem": "ä¸‹åˆ—å“ªä¸ªæ–¹æ³•å¯ä»¥å‘Pythonåˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Ÿ",
        "options": {
          "A": "add()",
          "B": "append()",
          "C": "insert()",
          "D": "extend()"
        },
        "answer": "B",
        "explanation": "append()æ–¹æ³•ç”¨äºåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å•ä¸ªå…ƒç´ ...",
        "difficulty": 3,
        "knowledge_point": "åˆ—è¡¨æ“ä½œ"
      },
      "review_comment": "é¢˜ç›®æ­£ç¡®ï¼Œæ— æ­§ä¹‰"
    }
  ],
  "needs_review_questions": [...],
  "rejected_questions": []
}
```

**å¿«é€Ÿç”Ÿæˆ (è·³è¿‡AIå®¡æ ¸)**
```bash
curl -X POST http://localhost:8000/api/questions/generate/quick \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "course_name": "æ•°æ®ç»“æ„",
    "question_type": "multiple",
    "difficulty": 4,
    "count": 5
  }'
```

**æ”¯æŒçš„é¢˜å‹**
```bash
curl http://localhost:8000/api/questions/types
```
```json
{
  "types": [
    {"value": "single", "label": "å•é€‰é¢˜", "description": "å››é€‰ä¸€ï¼Œåªæœ‰ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆ"},
    {"value": "multiple", "label": "å¤šé€‰é¢˜", "description": "å››é€‰å¤šï¼Œæœ‰2-3ä¸ªæ­£ç¡®ç­”æ¡ˆ"},
    {"value": "blank", "label": "å¡«ç©ºé¢˜", "description": "åœ¨é¢˜å¹²ç©ºç™½å¤„å¡«å…¥æ­£ç¡®ç­”æ¡ˆ"},
    {"value": "short", "label": "ç®€ç­”é¢˜", "description": "éœ€è¦è¯¦ç»†å›ç­”çš„ä¸»è§‚é¢˜"}
  ]
}
```

</details>

### è€ƒè¯•ç®¡ç†æ¨¡å— (`/api/exams`) âœ…

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | è®¤è¯ | è§’è‰² |
|------|------|------|------|------|
| POST | `/api/exams` | åˆ›å»ºè€ƒè¯• | æ˜¯ | æ•™å¸ˆ |
| GET | `/api/exams` | è·å–è€ƒè¯•åˆ—è¡¨ | æ˜¯ | å…¨éƒ¨ |
| GET | `/api/exams/{id}` | è·å–è€ƒè¯•è¯¦æƒ… | æ˜¯ | å…¨éƒ¨ |
| PUT | `/api/exams/{id}` | æ›´æ–°è€ƒè¯• | æ˜¯ | æ•™å¸ˆ |
| DELETE | `/api/exams/{id}` | åˆ é™¤è€ƒè¯• | æ˜¯ | æ•™å¸ˆ |
| POST | `/api/exams/{id}/publish` | å‘å¸ƒè€ƒè¯• | æ˜¯ | æ•™å¸ˆ |
| POST | `/api/exams/{id}/close` | å…³é—­è€ƒè¯• | æ˜¯ | æ•™å¸ˆ |
| POST | `/api/exams/{id}/questions` | æ·»åŠ é¢˜ç›®åˆ°è€ƒè¯• | æ˜¯ | æ•™å¸ˆ |
| GET | `/api/exams/{id}/questions` | è·å–è€ƒè¯•é¢˜ç›® | æ˜¯ | å…¨éƒ¨ |
| DELETE | `/api/exams/{id}/questions/{qid}` | åˆ é™¤é¢˜ç›® | æ˜¯ | æ•™å¸ˆ |
| POST | `/api/exams/{id}/start` | å¼€å§‹è€ƒè¯• | æ˜¯ | å­¦ç”Ÿ |
| GET | `/api/exams/{id}/attempt` | è·å–ç­”é¢˜è®°å½• | æ˜¯ | å­¦ç”Ÿ |
| POST | `/api/exams/{id}/answer` | ä¿å­˜ç­”æ¡ˆ | æ˜¯ | å­¦ç”Ÿ |
| POST | `/api/exams/{id}/submit` | æäº¤è€ƒè¯• | æ˜¯ | å­¦ç”Ÿ |
| GET | `/api/exams/{id}/attempts` | æŸ¥çœ‹æ‰€æœ‰ç­”é¢˜è®°å½• | æ˜¯ | æ•™å¸ˆ |

> å­¦ç”Ÿç«¯è·å–è€ƒè¯•åˆ—è¡¨æ—¶ï¼Œå“åº”ä¼šåŒ…å« `can_start` å­—æ®µï¼Œç”¨äºè¡¨ç¤ºå½“å‰æ—¶é—´çª—å£å†…æ˜¯å¦å…è®¸å¼€å§‹è€ƒè¯•ã€‚

<details>
<summary>ğŸ“ è€ƒè¯•ç®¡ç†APIç¤ºä¾‹</summary>

**åˆ›å»ºè€ƒè¯•**
```bash
curl -X POST http://localhost:8000/api/exams \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "PythonæœŸæœ«è€ƒè¯•",
    "duration_minutes": 90
  }'
```

**æ·»åŠ é¢˜ç›®åˆ°è€ƒè¯•**
```bash
curl -X POST http://localhost:8000/api/exams/1/questions \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "single",
    "stem": "Pythonä¸­å“ªä¸ªå…³é”®å­—ç”¨äºå®šä¹‰å‡½æ•°ï¼Ÿ",
    "options": {"A": "def", "B": "function", "C": "func", "D": "define"},
    "answer": {"correct": "A"},
    "score": 10
  }'
```

**ä»é¢˜åº“æ·»åŠ é¢˜ç›®åˆ°è€ƒè¯•ï¼ˆå¤ç”¨å·²æœ‰é¢˜ç›®ï¼‰**
```bash
curl -X POST http://localhost:8000/api/exams/1/questions \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "question_id": 123,
    "score": 10
  }'
```

> è¯´æ˜ï¼š`question_id` å­˜åœ¨æ—¶å°†ç›´æ¥å¤ç”¨é¢˜åº“ä¸­çš„é¢˜ç›®ï¼›`score` å¯é€‰ï¼Œä¸ä¼ åˆ™ä½¿ç”¨é¢˜ç›®é»˜è®¤åˆ†å€¼ã€‚

**å¼€å§‹è€ƒè¯•ï¼ˆä¼šæ ¡éªŒå¼€å§‹/ç»“æŸæ—¶é—´çª—å£ï¼‰**
```bash
curl -X POST http://localhost:8000/api/exams/1/start \
  -H "Authorization: Bearer <token>"
```

> è‹¥æœªåˆ°å¼€å§‹æ—¶é—´æˆ–å·²è¶…è¿‡ç»“æŸæ—¶é—´ï¼Œæ¥å£ä¼šè¿”å› `400` å¹¶ç»™å‡ºä¸­æ–‡é”™è¯¯åŸå› ï¼ˆä¾‹å¦‚â€œè€ƒè¯•å°šæœªå¼€å§‹ / è€ƒè¯•å·²ç»“æŸâ€ï¼‰ã€‚

**å“åº”ç¤ºä¾‹**
```json
{
  "id": 1,
  "type": "single",
  "stem": "Pythonä¸­å“ªä¸ªå…³é”®å­—ç”¨äºå®šä¹‰å‡½æ•°ï¼Ÿ",
  "options": {"A": "def", "B": "function", "C": "func", "D": "define"},
  "answer": {"correct": "A"},
  "score": 10,
  "message": "é¢˜ç›®æ·»åŠ æˆåŠŸ"
}
```

</details>

### å¾…å®ç°çš„ API ğŸš§

| æ¨¡å— | å‰ç¼€ | çŠ¶æ€ |
|------|------|------|
| è¯¾ç¨‹ç®¡ç† | `/api/courses` | âœ… å·²å®ç° |
| è€ƒè¯•ç®¡ç† | `/api/exams` | âœ… å·²å®ç° |
| è¯•å·ç®¡ç† | `/api/papers` | ğŸš§ å¾…å®ç° |
| AIæ‰¹æ”¹ | `/api/grading` | ğŸš§ å¾…å®ç° |
| ç»Ÿè®¡åˆ†æ | `/api/analytics` | ğŸš§ å¾…å®ç° |

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- ä½¿ç”¨Blackæ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨Ruffè¿›è¡Œä»£ç æ£€æŸ¥
- éµå¾ªPEP 8è§„èŒƒ

### ç±»å‹æ³¨è§£
æ‰€æœ‰å‡½æ•°å¿…é¡»æ·»åŠ ç±»å‹æ³¨è§£:
```python
async def get_user(user_id: int) -> User:
    ...
```

### å¼‚æ­¥ä¼˜å…ˆ
ä¼˜å…ˆä½¿ç”¨async/await:
```python
@app.get("/users/{user_id}")
async def get_user(user_id: int):
    user = await db.get_user(user_id)
    return user
```

### é”™è¯¯å¤„ç†
ä½¿ç”¨FastAPIçš„HTTPException:
```python
from fastapi import HTTPException

if not user:
    raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")
```

## ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| SECRET_KEY | JWTå¯†é’¥ | (å¿…é¡»ä¿®æ”¹) |
| DATABASE_URL | æ•°æ®åº“è¿æ¥ | sqlite+aiosqlite:///./app.db |
| LLM_PROVIDER | LLMæä¾›å•† | deepseek |
| DEEPSEEK_API_KEY | DeepSeek APIå¯†é’¥ | (éœ€é…ç½®) |
| DEEPSEEK_BASE_URL | DeepSeek APIåœ°å€ | https://api.deepseek.com/v1 |
| DEEPSEEK_MODEL | DeepSeekæ¨¡å‹å | deepseek-chat |
| LLM_TEMPERATURE | ç”Ÿæˆæ¸©åº¦ | 0.7 |
| LLM_MAX_TOKENS | æœ€å¤§tokenæ•° | 4000 |
| LLM_TIMEOUT | è¶…æ—¶æ—¶é—´(ç§’) | 60 |
| CORS_ORIGINS | å…è®¸çš„å‰ç«¯åŸŸå | ["http://localhost:5173"] |

## å¸¸ç”¨å‘½ä»¤

```bash
# æ ¼å¼åŒ–ä»£ç 
black app/

# ä»£ç æ£€æŸ¥
ruff check app/

# è¿è¡Œæµ‹è¯•
pytest

# æŸ¥çœ‹ä¾èµ–æ ‘
pip list

# å¯¼å‡ºä¾èµ–
pip freeze > requirements.txt
```

## æ•°æ®åº“è¿ç§»

(å¾…å®ç° Alembic)

## éƒ¨ç½²

(å¾…è¡¥å…… Dockeréƒ¨ç½²è¯´æ˜)

## è®¸å¯è¯

MIT License

---

**å¼€å‘çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­
**ç‰ˆæœ¬**: v1.1.0
**æœ€åæ›´æ–°**: 2026-01-10
