# 任务书 - QGen 智能出题与在线考试系统

## 1. 项目概述
本项目面向教学场景，提供 AI 智能出题、在线考试与自动批改能力，并支持题库管理与知识点体系化组织。当前仓库包含前端 React 应用与后端 FastAPI 服务，目标是完成可用的教学闭环：课程/知识点 -> 出题 -> 题库 -> 组卷/考试 -> 批改 -> 分析。

## 2. 当前进度概览（基于仓库现状）
已具备：
- 后端：认证体系、LLM Provider 抽象与题目生成流水线、课程/知识点 CRUD、题库 CRUD 与导入导出、考试管理与客观题自动评分。
- 前端：登录/注册与仪表板布局、题目生成/答题/结果页面、课程与知识点管理页面、题库页面、考试管理与学生答题页面、日志/时间记录等基础能力。

待完善/存在缺口：
- 主观题 AI 批改服务与结果展示。
- 试卷（paper）管理与题库复用（考试创建时选题/组卷能力）。
- 前后端题型定义不完全一致（前端包含代码题型，后端仅支持四类题型）。
- 学习分析与统计模块。
- 测试覆盖与部署文档。

## 3. 任务清单（按优先级）

### P0 - 必须完成（确保闭环可用）
1. 题型与数据结构统一  
   - 明确支持题型清单并统一前后端定义。  
   - 若保留代码题型，需扩展后端 Schema、校验与存储结构。  

2. 试卷/考试闭环  
   - 增加试卷（paper）管理 API 与前端 UI。  
   - 支持从题库选题组卷、调整分值与顺序。  
   - 考试创建绑定试卷，考试详情显示试卷题目。  

3. AI 批改与结果展示  
   - 新增 `/api/grading` 或扩展考试提交流程：主观题进入 AI 批改队列。  
   - 返回评分、评语与总分；补全前端考试结果页。  
   - 调整答题状态机：submitted -> graded，主观题未完成时可标记待批改。  

4. 认证与权限完整性  
   - 后端角色权限检查补齐（教师/学生/管理员）。  
   - 前端隐藏/禁用无权限入口，确保与后端一致。  

### P1 - 重要提升（可用性与可维护性）
1. 题目生成 -> 题库保存流程  
   - 生成后支持一键批量保存到题库并关联课程/知识点。  

2. 题库导入导出 UI  
   - 前端支持 JSON 导入导出与错误反馈。  

3. 测试与质量保障  
   - 后端服务层与 API 的单元/集成测试。  
   - 前端关键流程（生成、答题、考试提交）基本用例测试。  

4. 环境与配置统一  
   - `.env.example` 与文档同步，明确前后端联调方式与端口配置。  

### P2 - 增强与扩展（可选）
1. 学习分析与统计  
   - 错题本、薄弱点统计、学习建议与可视化报表。  

2. 运维与部署  
   - Docker 化、部署文档、基础监控与日志查看。  

## 4. 里程碑与交付物
M1（闭环可用）：题型统一 + 试卷管理 + 考试全流程可用。  
交付：试卷 API + 前端 UI + 考试创建/参加/提交可跑通。

M2（批改可用）：主观题 AI 批改 + 结果页完成。  
交付：批改 API + 批改结果展示 + 状态机完善。

M3（可运营）：学习分析与部署文档完善。  
交付：统计页面 + Docker 部署说明 + 简要运维指引。

## 5. 验收标准（关键功能）
- 课程/知识点：教师可创建/编辑/删除并在出题流程中选择。  
- 题库：题目 CRUD + 导入导出可用，权限控制生效。  
- 考试：教师可组卷/发布/关闭；学生可参加/提交并查看结果。  
- 批改：客观题自动评分，主观题 AI 批改返回评语与得分。  

## 6. 依赖与风险
- LLM API 密钥与调用成本：需要明确预算与调用频率控制。  
- 题型扩展与兼容：前后端题型不一致会导致数据异常。  
- 性能风险：流式生成/批改需处理超时与重试机制。  
- 数据迁移：后续若引入 Alembic 需规划现有表迁移策略。
